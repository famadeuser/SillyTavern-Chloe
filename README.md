# Chloe - å¢å¼ºç‰ˆ SillyTavern

åŸºäº [SillyTavern](https://github.com/SillyTavern/SillyTavern) çš„å¢å¼ºç‰ˆæœ¬ï¼Œæ·»åŠ äº† OAuth ç™»å½•ã€ç”¨æˆ·ç®¡ç†å’Œç§¯åˆ†ç³»ç»Ÿã€‚

## âœ¨ æ–°å¢åŠŸèƒ½

### ğŸ” èº«ä»½éªŒè¯ç³»ç»Ÿ
- **OAuth ç™»å½•**
  - æ”¯æŒ Discord OAuth ç™»å½•
  - æ”¯æŒ LinuxDo OAuth ç™»å½•
  - OAuth ç™»å½•æ”¯æŒé‚€è¯·ç ï¼ˆæ³¨å†Œå…³é—­æ—¶ä»å¯é€šè¿‡é‚€è¯·ç æ³¨å†Œï¼‰
  - å®‰å…¨çš„çŠ¶æ€éªŒè¯å’Œä¼šè¯ç®¡ç†
  - è‡ªåŠ¨åˆ›å»ºç”¨æˆ·è´¦æˆ·

- **è´¦å·å¯†ç ç™»å½•**
  - ç»Ÿä¸€åƒç´ é£æ ¼çš„ç™»å½•ç•Œé¢ï¼ˆ`/login.html`ï¼‰
  - å¯†ç å®‰å…¨éªŒè¯
  - ç”¨æˆ·å¯†ç ä¿®æ”¹åŠŸèƒ½
  - ç™»å½•å¤±è´¥ä¿æŠ¤

### ğŸ‘¥ ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- å¤šç”¨æˆ·æ”¯æŒï¼Œæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨
- ç”¨æˆ·ç§¯åˆ†ç³»ç»Ÿ
- æ¯æ—¥ç­¾åˆ°åŠŸèƒ½
- å…‘æ¢ç ç³»ç»Ÿï¼ˆç§¯åˆ†å……å€¼ï¼‰

### ğŸŸï¸ é‚€è¯·ç æ³¨å†Œç³»ç»Ÿ
- **é‚€è¯·ç æ³¨å†Œ**ï¼ˆ`/register.html`ï¼‰
  - æ”¯æŒè¿‡æœŸæ—¶é—´è®¾ç½®ï¼ˆ1-365å¤©æˆ–æ°¸ä¹…æœ‰æ•ˆï¼‰
  - é‚€è¯·ç æ³¨å†Œä¸å—"å…³é—­æ³¨å†Œ"å¼€å…³é™åˆ¶
  - ç”¨æˆ·åé»‘åå•éªŒè¯
  - å¼ºå¯†ç è¦æ±‚

- **OAuth + é‚€è¯·ç **
  - åœ¨ OAuth ç™»å½•é¡µé¢è¾“å…¥é‚€è¯·ç 
  - å…³é—­æ³¨å†Œæ—¶ï¼ŒæŒæœ‰æ•ˆé‚€è¯·ç ç”¨æˆ·ä»å¯é€šè¿‡ OAuth æ³¨å†Œ

### ğŸ¨ ç”¨æˆ·ç•Œé¢
- **ç»Ÿä¸€åƒç´ è‰ºæœ¯é£æ ¼**
  - OAuth ç™»å½•é¡µï¼ˆ`/oauth.html`ï¼‰
  - è´¦å·å¯†ç ç™»å½•é¡µï¼ˆ`/login.html`ï¼‰
  - é‚€è¯·ç æ³¨å†Œé¡µï¼ˆ`/register.html`ï¼‰
  - ç”¨æˆ·ä¸»é¡µï¼ˆ`/home.html`ï¼‰
  - ç®¡ç†å‘˜æ§åˆ¶é¢æ¿ï¼ˆ`/admin.html`ï¼‰

- **åŠ¨ç”»æ•ˆæœ**
  - ç²’å­ç³»ç»ŸèƒŒæ™¯
  - å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
  - äº¤äº’åé¦ˆæ•ˆæœ
  - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

### âš™ï¸ ç®¡ç†åŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†**
  - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
  - åˆ é™¤ç”¨æˆ·
  - é‡ç½®ç”¨æˆ·å¯†ç 
  - æŸ¥çœ‹ç”¨æˆ·ç§¯åˆ†

- **é‚€è¯·ç ç®¡ç†**
  - æ‰¹é‡ç”Ÿæˆé‚€è¯·ç ï¼ˆæœ€å¤š100ä¸ªï¼‰
  - è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ1-365å¤©ï¼‰
  - æŸ¥çœ‹ä½¿ç”¨çŠ¶æ€ï¼ˆæœªä½¿ç”¨/å·²ä½¿ç”¨/å·²è¿‡æœŸï¼‰
  - æŸ¥çœ‹ä½¿ç”¨è€…ä¿¡æ¯

- **å…‘æ¢ç ç®¡ç†**
  - ç”Ÿæˆå…‘æ¢ç 
  - è®¾ç½®ç§¯åˆ†é¢é¢
  - æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ

- **ç³»ç»Ÿè®¾ç½®**
  - æ³¨å†Œå¼€å…³æ§åˆ¶
  - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯

## ğŸ–¼ï¸ ç•Œé¢ä¸€è§ˆ

![](https://youke1.picui.cn/s1/2025/11/13/6914bae697ddf.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bae709c2f.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bae9a8473.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baeaa50a6.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baec59638.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baef3430a.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baf1b669b.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baf61298a.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baf7cd36b.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baf9b3a4f.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bafc66619.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bafdb5beb.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914baff164c8.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bb04708db.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bb07af7a7.jpg)

![](https://youke1.picui.cn/s1/2025/11/13/6914bb0958858.jpg)

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬
- è‡³å°‘ 4GB RAM
- 10GB å¯ç”¨ç£ç›˜ç©ºé—´

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®

#### 2.1 é…ç½®æ–‡ä»¶

å¤åˆ¶ `default/config.yaml` åˆ°é¡¹ç›®æ ¹ç›®å½•çš„ `config.yaml`ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```yaml
# å¯ç”¨å¤šç”¨æˆ·æ¨¡å¼
enableUserAccounts: true

# OAuth é…ç½®
oauth:
  redirectUri: 'https://your-domain.com/oauth'
  discord:
    clientId: 'YOUR_DISCORD_CLIENT_ID'
    clientSecret: 'YOUR_DISCORD_CLIENT_SECRET'
  linuxdo:
    clientId: 'YOUR_LINUXDO_CLIENT_ID'
    clientSecret: 'YOUR_LINUXDO_CLIENT_SECRET'
```

#### 2.2 ç¯å¢ƒå˜é‡ï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰

è®¾ç½®ç®¡ç†å‘˜å‡­æ®ï¼ˆ**å¿…éœ€**ï¼‰ï¼š

```bash
# Linux/macOS
export ADMIN_USERNAME="your_admin_username"
export ADMIN_PASSWORD="your_secure_password"

# æˆ–åœ¨å¯åŠ¨æ—¶æŒ‡å®š
ADMIN_USERNAME="admin" ADMIN_PASSWORD="secure123" node server.js
```

```powershell
# Windows PowerShell
$env:ADMIN_USERNAME="your_admin_username"
$env:ADMIN_PASSWORD="your_secure_password"
```

æˆ–åˆ›å»º `.env` æ–‡ä»¶ï¼ˆéœ€è¦å®‰è£… `dotenv`ï¼‰ï¼š
```env
ADMIN_USERNAME=your_admin_username
ADMIN_PASSWORD=your_secure_password
```

**âš ï¸ é‡è¦å®‰å…¨æç¤ºï¼š**
- âœ… ç®¡ç†å‘˜å‡­æ®é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼Œä¸å†ç¡¬ç¼–ç 
- âœ… ä¸è¦å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ `config.yaml` æˆ– `.env` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… ä½¿ç”¨å¼ºå¯†ç å’Œå®‰å…¨çš„å¯†é’¥
- âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ AWS Secrets Managerã€HashiCorp Vaultï¼‰

### 3. å¯åŠ¨æœåŠ¡

```bash
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ã€‚

## ğŸ”§ é…ç½® OAuth

### Discord OAuth

1. è®¿é—® [Discord Developer Portal](https://discord.com/developers/applications)
2. åˆ›å»ºæ–°åº”ç”¨
3. åœ¨ OAuth2 è®¾ç½®ä¸­æ·»åŠ å›è°ƒ URLï¼š`https://your-domain.com/oauth`
4. å¤åˆ¶ Client ID å’Œ Client Secret åˆ°é…ç½®æ–‡ä»¶

### LinuxDo OAuth

1. åœ¨ LinuxDo å¹³å°ç”³è¯· OAuth åº”ç”¨
2. é…ç½®å›è°ƒ URLï¼š`https://your-domain.com/oauth`
3. å°†å‡­æ®æ·»åŠ åˆ°é…ç½®æ–‡ä»¶

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ oauth.js              # OAuth ç™»å½•é€»è¾‘ï¼ˆæ”¯æŒé‚€è¯·ç ï¼‰
â”‚   â”œâ”€â”€ endpoints/
â”‚   â”‚   â”œâ”€â”€ admin.js          # ç®¡ç†å‘˜æ¥å£ï¼ˆé‚€è¯·ç /å…‘æ¢ç ç®¡ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ account.js        # ç”¨æˆ·è´¦æˆ·æ¥å£ï¼ˆå¯†ç ä¿®æ”¹ï¼‰
â”‚   â”‚   â””â”€â”€ users-public.js   # å…¬å¼€ç”¨æˆ·æ¥å£ï¼ˆæ³¨å†Œ/ç™»å½•ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ oauth.html            # OAuth ç™»å½•é¡µï¼ˆæ”¯æŒé‚€è¯·ç è¾“å…¥ï¼‰
â”‚   â”œâ”€â”€ login.html            # è´¦å·å¯†ç ç™»å½•é¡µ
â”‚   â”œâ”€â”€ register.html         # é‚€è¯·ç æ³¨å†Œé¡µ
â”‚   â”œâ”€â”€ home.html             # ç”¨æˆ·ä¸»é¡µ
â”‚   â”œâ”€â”€ admin.html            # ç®¡ç†å‘˜æ§åˆ¶é¢æ¿
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ oauth-login.js    # OAuth é¡µé¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ password-login.js # å¯†ç ç™»å½•é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ register.js       # æ³¨å†Œé¡µé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ home.js           # ç”¨æˆ·ä¸»é¡µé€»è¾‘
â”‚   â”‚   â””â”€â”€ admin.js          # ç®¡ç†åå°é€»è¾‘
â”‚   â””â”€â”€ css/
â”‚       â”œâ”€â”€ oauth.css         # ç»Ÿä¸€åƒç´ é£æ ¼æ ·å¼
â”‚       â””â”€â”€ home.css          # ç”¨æˆ·ä¸»é¡µæ ·å¼
â”œâ”€â”€ ops/
â”‚   â””â”€â”€ Caddyfile             # Caddy åå‘ä»£ç†é…ç½®
â””â”€â”€ default/
    â””â”€â”€ config.yaml           # é…ç½®æ¨¡æ¿
```

## ğŸ› ï¸ å¼€å‘

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦è°ƒè¯•ï¼‰
npm run debug

# ä»£ç æ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç é£æ ¼
npm run lint:fix
```

## ğŸ³ Docker éƒ¨ç½²

```bash
docker compose -f docker/docker-compose.yml up -d
```

## ğŸ“š API ç«¯ç‚¹

### è®¤è¯ç«¯ç‚¹
- `GET /auth/discord` - å‘èµ· Discord OAuth ç™»å½•ï¼ˆæ”¯æŒ `?invite=CODE` å‚æ•°ï¼‰
- `GET /auth/linuxdo` - å‘èµ· LinuxDo OAuth ç™»å½•ï¼ˆæ”¯æŒ `?invite=CODE` å‚æ•°ï¼‰
- `GET /oauth` - OAuth å›è°ƒå¤„ç†
- `POST /api/users/login` - è´¦å·å¯†ç ç™»å½•
- `POST /api/users/register` - é‚€è¯·ç æ³¨å†Œ

### ç”¨æˆ·ç«¯ç‚¹
- `GET /api/account/info` - è·å–è´¦æˆ·ä¿¡æ¯
- `POST /api/account/checkin` - æ¯æ—¥ç­¾åˆ°
- `POST /api/account/redeem` - ä½¿ç”¨å…‘æ¢ç 
- `POST /api/account/change-password` - ä¿®æ”¹å¯†ç 

### ç®¡ç†å‘˜ç«¯ç‚¹

#### ç”¨æˆ·ç®¡ç†
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/admin/users/delete` - åˆ é™¤ç”¨æˆ·
- `POST /api/admin/users/reset-password` - é‡ç½®ç”¨æˆ·å¯†ç 

#### é‚€è¯·ç ç®¡ç†
- `POST /api/admin/invite-codes` - æ‰¹é‡ç”Ÿæˆé‚€è¯·ç 
  - å‚æ•°ï¼š`count`ï¼ˆæ•°é‡ï¼‰ã€`expiresInDays`ï¼ˆè¿‡æœŸå¤©æ•°ï¼Œå¯é€‰ï¼‰
- `GET /api/admin/invite-codes` - è·å–é‚€è¯·ç åˆ—è¡¨
- `DELETE /api/admin/invite-codes/:code` - åˆ é™¤é‚€è¯·ç 

#### å…‘æ¢ç ç®¡ç†
- `POST /api/admin/redeem-codes` - ç”Ÿæˆå…‘æ¢ç 
- `GET /api/admin/redeem-codes` - è·å–å…‘æ¢ç åˆ—è¡¨

#### ç³»ç»Ÿè®¾ç½®
- `POST /api/admin/toggle-registration` - åˆ‡æ¢æ³¨å†Œå¼€å…³
- `GET /api/admin/system-config` - è·å–ç³»ç»Ÿé…ç½®
- `GET /api/admin/stats` - è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯

## ğŸ”’ å®‰å…¨æ€§

### å·²å®æ–½çš„å®‰å…¨æªæ–½

1. **ç®¡ç†å‘˜å‡­æ®ä¿æŠ¤**
   - âœ… ç®¡ç†å‘˜è´¦å·å¯†ç é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
   - âœ… ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
   - âœ… é»˜è®¤å‡­æ®éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹

2. **å¯†ç å®‰å…¨**
   - âœ… ä½¿ç”¨ scrypt è¿›è¡Œå¯†ç å“ˆå¸Œ
   - âœ… æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„ç›å€¼
   - âœ… å¯†ç é•¿åº¦è¦æ±‚ï¼ˆ6-128ä½ï¼‰
   - âœ… å¯†ç ä¿®æ”¹éœ€éªŒè¯å½“å‰å¯†ç 

3. **ä¼šè¯å®‰å…¨**
   - âœ… CSRF Token ä¿æŠ¤
   - âœ… å®‰å…¨çš„ä¼šè¯ç®¡ç†
   - âœ… OAuth çŠ¶æ€éªŒè¯

4. **é‚€è¯·ç å®‰å…¨**
   - âœ… é‚€è¯·ç å•æ¬¡ä½¿ç”¨
   - âœ… æ”¯æŒè¿‡æœŸæ—¶é—´è®¾ç½®
   - âœ… å®‰å…¨çš„éšæœºç ç”Ÿæˆ

5. **è¾“å…¥éªŒè¯**
   - âœ… ç”¨æˆ·åé»‘åå•è¿‡æ»¤
   - âœ… ç”¨æˆ·åæ ¼å¼éªŒè¯
   - âœ… å¯†ç å¼ºåº¦è¦æ±‚
   - âœ… SQLæ³¨å…¥é˜²æŠ¤

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **SSL/TLS**ï¼šåŠ¡å¿…å¯ç”¨ HTTPS
2. **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆAWS Secrets Managerã€HashiCorp Vaultç­‰ï¼‰
3. **æ—¥å¿—å®¡è®¡**ï¼šå¯ç”¨è®¿é—®æ—¥å¿—å’Œæ“ä½œæ—¥å¿—
4. **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®å’Œé…ç½®
5. **é˜²ç«å¢™**ï¼šé™åˆ¶ç®¡ç†æ¥å£è®¿é—®
6. **æ›´æ–°ç»´æŠ¤**ï¼šåŠæ—¶æ›´æ–°ä¾èµ–åŒ…

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.1.0 (æœ€æ–°)

**æ–°å¢åŠŸèƒ½**
- âœ¨ é‚€è¯·ç ç³»ç»Ÿæ”¯æŒè¿‡æœŸæ—¶é—´è®¾ç½®
- âœ¨ OAuth ç™»å½•æ”¯æŒé‚€è¯·ç æ³¨å†Œ
- âœ¨ æ–°å¢ç»Ÿä¸€é£æ ¼çš„è´¦å·å¯†ç ç™»å½•é¡µé¢
- âœ¨ æ–°å¢ç»Ÿä¸€é£æ ¼çš„é‚€è¯·ç æ³¨å†Œé¡µé¢
- âœ¨ ç”¨æˆ·å¯†ç ä¿®æ”¹åŠŸèƒ½
- âœ¨ ç”¨æˆ·åé»‘åå•éªŒè¯

**å®‰å…¨æ”¹è¿›**
- ğŸ”’ ç®¡ç†å‘˜å‡­æ®æ”¹ä¸ºç¯å¢ƒå˜é‡é…ç½®
- ğŸ”’ ç§»é™¤ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
- ğŸ”’ å¢å¼ºå¯†ç å®‰å…¨ç­–ç•¥

**ç•Œé¢ä¼˜åŒ–**
- ğŸ¨ ç»Ÿä¸€åƒç´ è‰ºæœ¯é£æ ¼è®¾è®¡
- ğŸ¨ æ·»åŠ åŠ¨ç”»æ•ˆæœå’Œç²’å­ç³»ç»Ÿ
- ğŸ¨ æ”¹è¿›è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
- ğŸ¨ æ”¯æŒç§»åŠ¨ç«¯æ»šåŠ¨æµè§ˆ

### v1.0.0

**åˆå§‹ç‰ˆæœ¬**
- ğŸ‰ OAuth ç™»å½•ç³»ç»Ÿï¼ˆDiscordã€LinuxDoï¼‰
- ğŸ‰ å¤šç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- ğŸ‰ ç§¯åˆ†ç³»ç»Ÿå’Œç­¾åˆ°åŠŸèƒ½
- ğŸ‰ å…‘æ¢ç ç³»ç»Ÿ
- ğŸ‰ ç®¡ç†å‘˜æ§åˆ¶é¢æ¿

## ğŸ“– æ–‡æ¡£

è¯¦ç»†éƒ¨ç½²æ–‡æ¡£è¯·å‚è€ƒ [DEPLOYMENT.md](./DEPLOYMENT.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº AGPL-3.0 è®¸å¯è¯å¼€æºã€‚

## ğŸ™ è‡´è°¢

- [SillyTavern](https://github.com/SillyTavern/SillyTavern) - åŸå§‹é¡¹ç›®
- æ‰€æœ‰è´¡çŒ®è€…å’Œæ”¯æŒè€…

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚ä½¿ç”¨æœ¬é¡¹ç›®æ‰€é€ æˆçš„ä¸€åˆ‡åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚
